<!DOCTYPE html>
<html>
<body>	 
	<script>
function openBooking() {
  const bookingUrl = "https://booking.external-service.com/start"; 
  const bookingWin = window.open(bookingUrl, "bookingWindow", "width=900,height=700");

  if (!bookingWin) {
    alert("Please allow popups for this site.");
    return;
  }

  // Таймер за проверка дали е затворено без статус
  const checkTimer = setInterval(() => {
    if (bookingWin.closed) {
      clearInterval(checkTimer);
      console.log("Booking closed midway (no confirmation received)");
    }
  }, 500);

  // Приемане на съобщения от child (cross-origin safe)
  window.addEventListener("message", (event) => {
    // Филтрираме по домейн за сигурност
    if (event.origin !== "https://booking.external-service.com") return;

    if (event.data?.type === "bookingStatus") {
      clearInterval(checkTimer);
      console.log("Booking status from child:", event.data.status);
      bookingWin.close();
    }
  });
}
</script>

<button onclick="openBooking()">Book Maintenance</button>


</body>
</html>
